<section
  class="bg-[rgba(30,41,59,0.5)] min-w-[952px] min-h-[100px] rounded-t-[4px] flex flex-col justify-between"
>
  <ng-container
    *ngIf="allPlayers$ | async; let createdPlayers; else: loadingPlayers"
  >
    <div class="flex pl-[5px]">
      <ng-container
        ><ng-container *ngFor="let p of selectPlayersForm.value; let i = index">
          <mat-form-field
            appearance="outline"
            color="accent"
            class="w-[120px] m-[19px] mb-0 mr-0"
          >
            <mat-label>Player {{ i + 1 }}</mat-label>
            <mat-select
              [(ngModel)]="selectedPlayers[i]"
              (selectionChange)="choosePlayer(i, selectedPlayers[i])"
            >
              <mat-option
                *ngFor="let player of createdPlayers"
                [value]="player"
              >
                {{ player.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <div
            *ngIf="i === selectPlayersForm.value.length - 1"
            class="ml-[20px] flex items-center"
          >
            <button
              mat-button
              class="text-indigo-300"
              (click)="addPlayer()"
              [disabled]="
                selectPlayersForm.value.length >= 8 ||
                !selectPlayersForm.value[i]
              "
            >
              <mat-icon>person_add</mat-icon>
            </button>
            <button
              mat-button
              class="text-red-300"
              (click)="removePlayer(i)"
              [disabled]="selectPlayersForm.value.length <= 1"
            >
              <mat-icon>person_remove</mat-icon>
            </button>
          </div>
        </ng-container>
      </ng-container>
    </div>

    <div class="m-[24px] mt-0 flex justify-between">
      <div class="flex items-center">
        <button
          mat-raised-button
          color="accent"
          [disabled]="
            alreadyChosenError ||
            selectPlayersForm.value.length < 2 ||
            selectPlayersForm.invalid
          "
          (click)="validatePlayers.emit()"
        >
          Validate players
        </button>
        <mat-error *ngIf="alreadyChosenError" class="ml-[24px]"
          >A player is chosen twice</mat-error
        >
        <mat-error
          *ngIf="
            selectPlayersForm.value.length < 2 || !selectPlayersForm.value[1]
          "
          class="ml-[24px]"
          >Select minimum 2 players to start a game</mat-error
        >
      </div>
      <button
        mat-raised-button
        mat-dialog-close
        color="primary"
        (click)="openCreatePlayerForm()"
      >
        Create new player
      </button>
    </div>
  </ng-container>
  <ng-template #loadingPlayers>
    <div class="h-[100px] flex items-center justify-center">
      <div class="flex items-center">
        <mat-spinner [diameter]="25"></mat-spinner>
        <span class="text-lg text-slate-200"
          >&nbsp; Loading players ...</span
        >
      </div>
    </div>
  </ng-template>
</section>
